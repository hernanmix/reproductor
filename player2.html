<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Reproductor</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      width: 100%;
      background: #000;
    }
    #player {
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <div id="player"></div>

  <!-- JWPlayer -->
  <script src="https://ssl.p.jwpcdn.com/player/v/8.26.0/jwplayer.js"></script>
  <script>
    jwplayer.key = "XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo";

    function getQueryParameter(name) {
      return new URLSearchParams(window.location.search).get(name);
    }

    async function scrapeStream(streamName) {
      try {
        const url = `https://streamtp10.com/global1.php?stream=${streamName}`;
        const response = await fetch(url);
        const html = await response.text();

        // Buscar URL .m3u8 o .mpd
        const regex = /(https?:\/\/[^"']+\.(m3u8|mpd)[^"']*)/i;
        const match = html.match(regex);

        if (match) {
          const streamUrl = match[1];
          if (streamUrl.startsWith("http")) {
            return streamUrl;
          }
        }
        return null;
      } catch (err) {
        console.error("Error en scraper:", err);
        return null;
      }
    }

    function setupPlayer(url) {
      jwplayer("player").setup({
        file: url,
        type: url.endsWith(".m3u8") ? "hls" : "dash",
        autostart: true,
        width: "100%",
        height: "100%",
        stretching: "uniform",
        skin: { name: "cyan" }
      });
    }

    document.addEventListener("DOMContentLoaded", async function () {
      // üîπ Usa ID en may√∫sculas
      const id = getQueryParameter("ID");
      if (!id) {
        document.getElementById("player").innerHTML =
          "<p style='color:red'>No se encontr√≥ par√°metro ID</p>";
        return;
      }

      const streamUrl = await scrapeStream(id);
      if (streamUrl) {
        setupPlayer(streamUrl);
      } else {
        document.getElementById("player").innerHTML =
          "<p style='color:red'>No se pudo extraer stream</p>";
      }
    });
  </script>
</body>
</html>
