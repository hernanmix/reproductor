<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Reproductor Live</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body { margin:0; background:#000; }
    #player { width:100%; height:100vh; }
  </style>
</head>
<body>
  <div id="player"></div>

  <!-- JWPlayer CDN -->
  <script src="//ssl.p.jwpcdn.com/player/v/8.25.1/jwplayer.js"></script>
  <script>
    // Tu licencia JWPlayer
    jwplayer.key = "XSuP4qMl+9tK17QNb+4+th2Pm9AWgMO/cYH8CI0HGGr7bdjo";

    // Obtener par치metro id de la URL
    function getQueryParameter(name) {
      let urlParams = new URLSearchParams(window.location.search);
      return urlParams.get(name);
    }

    function setupPlayer(jsonData) {
      var imageUrl = "https://disney.images.edge.bamgrid.com/ripcut-delivery/v2/variant/disney/" 
                     + jsonData.img + "/compose";

      jwplayer("player").setup({
        playlist: [{
          image: imageUrl,
          sources: [{
            default: true,
            type: "dash",
            file: jsonData.url,
            drm: {
              clearkey: { keyId: jsonData.k1, key: jsonData.k2 }
            },
            label: "HD"
          }]
        }],
        width: "100%",
        height: "100vh",
        autostart: true,
        stretching: "uniform",
        controls: true
      });
    }

    document.addEventListener("DOMContentLoaded", function() {
      var id = getQueryParameter("id");
      if (id) {
        fetch("https://jstreamec.github.io/ecplaytv/final_events.json?v=" + Date.now())
          .then(response => response.json())
          .then(data => {
            const matchingItem = data.find(item => item.nombre === id);
            if (matchingItem) {
              setupPlayer(matchingItem);
            } else {
              document.getElementById("player").innerHTML = 
                "<p style='color:red'>Evento no encontrado</p>";
            }
          })
          .catch(error => {
            console.error("Error cargando JSON:", error);
            document.getElementById("player").innerHTML = 
              "<p style='color:red'>Error cargando transmisi칩n</p>";
          });
      } else {
        document.getElementById("player").innerHTML = 
          "<p style='color:red'>No se encontr칩 par치metro id</p>";
      }
    });
  </script>
</body>
</html>
